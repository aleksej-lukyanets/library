<?xml version='1.0' encoding='UTF-8' ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html">

    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link href="${request.contextPath}/resources/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="${request.contextPath}/resources/css/customization.css" rel="stylesheet" type="text/css" />
        <script src="${request.contextPath}/resources/js/jquery-1.9.0.min.js" type="text/javascript"></script>
        <script src="${request.contextPath}/resources/js/bootstrap.min.js" type="text/javascript"></script>
        <title>Библиотека — JSF</title>
    </h:head>

    <h:body>
        <!--
        Интерфейс пользователя.
        -->
        <div align="center">
            <div id="bodyfield" align="left">
                <div class="clearfix" style="margin: 0 0 20px -10px;">
                    <div class="btn-group">
                        <span class="btn btn-xs btn-default disabled">сервлет JSF</span>
                        <a href="${request.contextPath}/" class="btn btn-xs btn-default">вернуться к Spring-реализации</a>
                    </div>
                    <div class="btn-group pull-right">
                        <a id="details" class="btn btn-danger">Как это работает?</a>
                    </div>
                </div>
                <table width="100%">
                    <tr>
                        <td width="40%"><h2>Авторы:</h2></td>
                        <td width="60%"><h2>Книги:</h2></td>
                    </tr>
                    <tr>
                        <td valign="top">
                            <ui:insert name="authors">authors</ui:insert>
                        </td>
                        <td valign="top">
                            <ui:insert name="books">books</ui:insert>
                        </td>
                    </tr>
                    <tr>
                        <td class="verticalSpace">
                            <h:form id="authorsControl">
                                <input type="button" id="btnAddAuthor" value="добавить автора" class="btn btn-sm btn-default" />&nbsp;
                                <h:commandButton value="удалить автора" rendered="#{authorsBean.selectedAuthorId != 0}" styleClass="btn btn-sm btn-danger">
                                    <f:ajax execute="@form" render=":authorsList :authorsControl :booksList :booksControl :addBook:authorSelect" listener="#{authorsBean.removeAuthor}"/>
                                </h:commandButton>
                            </h:form>
                        </td>
                        <td class="verticalSpace">
                            <h:form id="booksControl">
                                <h:commandButton value="показать все книги" styleClass="btn btn-sm btn-primary btn-pad-right" rendered="#{authorsBean.selectedAuthorId != 0}">
                                    <f:ajax execute="@form" render="@form :authorsList :authorsControl :booksList" listener="#{authorsBean.clearAuthorSelected}"/>
                                </h:commandButton>
                                <input type="button" id="btnAddBook" value="добавить книгу" class="btn btn-sm btn-default btn-pad-right" />
                                <h:commandButton value="удалить книгу" rendered="#{booksBean.selectedBookId != 0}" styleClass="btn btn-sm btn-danger">
                                    <f:ajax execute="@form" render="@form :booksList" listener="#{booksBean.removeBook}"/>
                                </h:commandButton>
                            </h:form>
                        </td>
                    </tr>
                </table>
                <div class="footer">
                    <ul class="list-inline">
                        <li><a href="https://github.com/aleksej-lukyanets/library">исходные коды на github</a></li>
                        <li><a href="http://spb.hh.ru/resume/002aa1acff01bbb6c90039ed1f744c5a305658">резюме на hh.ru</a></li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!--
        Окна добавления авторов и книг.
        -->
        <div id="addAuthorModal" class="modal bs-example-modal-sm modal-bottom-fixed" tabindex="-1" role="dialog" aria-labelledby="detailsModal" aria-hidden="true">
            <div class="modal-dialog modal-sm" style="line-height:160%;">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4>Добавление автора</h4>
                    </div>
                    <div class="modal-body">
                        <ui:insert name="addAuthor">addAuthor</ui:insert>
                    </div>
                </div>
            </div>
        </div>
        <div id="addBookModal" class="modal bs-example-modal-sm modal-bottom-fixed" tabindex="-1" role="dialog" aria-labelledby="detailsModal" aria-hidden="true">
            <div class="modal-dialog modal-sm" style="line-height:160%;">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4>Добавление книги</h4>
                    </div>
                    <div class="modal-body">
                        <ui:insert name="addBook">addBook</ui:insert>
                    </div>
                </div>
            </div>
        </div>
        <script type="text/javascript">
            $('body').delegate('#btnAddAuthor', 'click', function() {
                $('#addAuthorModal').modal({show: true});
            });
            $('body').delegate('#btnAddBook', 'click', function() {
                $('#addBookModal').modal({show: true});
            });
        </script>
        
        <!--
        Окно "Как всё работает?"
        -->
        <div id="detailsModal" class="modal" tabindex="-1" role="dialog" aria-labelledby="detailsModal" aria-hidden="true">
            <div class="modal-dialog" style="line-height:160%;">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4>Добро пожаловать в веб-библиотеку (JSF)</h4>
                    </div>
                    <div class="modal-body">
                        <p>Сервлет библиотеки на технологии JavaServer Faces 2.2 обладает тем же функционалом,
                            что и сервлет на Spring MVC. В данном случае они используют
                            общие сервисный слой, слой доступа к данным и базу данных.</p>
                        
                        <h4 class="modal-title">Отличия реализаций JSF и Spring MVC</h4>
                        
                        <p>1. В случае Spring MVC все манипуляции с ресурсами сервлета производились
                            средствами JavaScript и AJAX. В данной JSF-реализации функции JavaScript
                            невелики и немногочисленны, для обращения к серверу использован
                            встроенный в JSF AJAX-компонент <code>f:ajax</code>.</p>
                        
                        <p>2. Данные JSF-сервлета (списки авторов, книг, стран) здесь
                            не доступны в качестве ресурсов в стиле REST, они могут быть запрошены
                            или изменены только через интерфейс веб-страницы.</p>
                        
                        <h4 class="modal-title">Технологии</h4>
                        
                        <p>Приложение разработано на Java с использованием технологий:</p>
                        <ul class="discharged">
                            <li>сервлет: JavaServer Faces, Spring IoC;</li>
                            <li>доступ к данным: Hibernate;</li>
                            <li>веб-интерфейс: jQuery, Bootstrap;</li>
                            <li>база данных: PostgreSQL;</li>
                            <li>контейнер сервлетов: Apache Tomcat.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <script type="text/javascript">
            $('body').delegate('#details', 'click', function() {
                $('#detailsModal').modal({show: true});
            });
        </script>
    </h:body>
</html>
